@using Template.Models
@model IList<Module>
@section Scripts
{
    <script type="text/javascript">
        window.sortModule = function() {
            $(".dd-list a.btn-success", this).show();
            $(".dd-list li li li a.btn-success", this).hide();
        };
    </script>
}
@helper TreeView(IOrderedEnumerable<Module> modules, int level)
{
    foreach (var module in modules)
    {
        <li class="dd-item dd3-item" data-id="@module.Id">
            <div class="dd-handle dd3-handle">Drag</div>
            <div class="dd3-content">
                <i class="fa @module.CssClass"></i> @module.Name
                <div class="pull-right">
                    <a href="@Url.Action("New", new RouteValueDictionary{{"Parent.Id",module.Id}})" class="btn btn-xs btn-success" style="@(level >= 2 ? "display:none":"")" title="Adicionar"><i class="fa fa-plus-circle"></i></a>
                    <a href="@Url.Action("Edit", new {module.Id})" class="btn btn-xs btn-primary" title="Editar"><i class="fa fa-pencil"></i></a>
                    <a href="@Url.Action("Delete", new {module.Id})" class="btn btn-xs btn-danger btn-delete-row" title="Excluir"><i class="fa fa-trash-o"></i></a>
                </div>
            </div>
            @if (module.Childs.Any())
            {
                <ol class="dd-list">
                    @TreeView(module.Childs.OrderBy(x => x.Order), level+1)
                </ol>
            }
        </li>
    }
}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            Módulos
            <span class="pull-right">
                <a class="btn btn-primary" href="@Url.Action("New")" title="Novo"><i class="fa fa-plus"></i></a>
            </span>
        </h1>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="dd" data-control="nestable" data-max-depth="3" data-organize-url="@Url.Action("Organazer")" data-change="sortModule">
            <ol class="dd-list">
                @TreeView(Model.OrderBy(x => x.Order), 0)
            </ol>
        </div>
    </div>
</div>